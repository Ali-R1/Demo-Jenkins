pipeline {
    agent any
    stages {
        stage ('Git clone framework') {
            steps {
                dir ('framework') {
                    git credentialsId: 'e761c4d7-4840-4fd4-a715-1c15aee5c69f', url: 'git@github.com:Ali-R1/Demo-Framework.git'
                }
            }
        }
        
        stage ('Git clone content') {
            steps {
                dir ('content') {
                    git credentialsId: 'e761c4d7-4840-4fd4-a715-1c15aee5c69f', url: 'git@github.com:Ali-R1/Demo-Web.git'
                }
            }
        }
        
        stage ('Build') {
            steps {
                powershell label: '', script: '''$bottom = get-content "$($pwd.path)\\framework\\bottom.html"
$replace = "<!--Jenkins-->"
$badge = "<a href=\'http://localhost:8080/job/$($env:JOB_NAME)/\'><img src=\'http://localhost:8080/job/$($env:JOB_NAME)/badge/icon\'></a>"
$buildInfo = "Deployed by Jenkins (Build $($env:BUILD_NUMBER)) on $(get-date) $badge"
$bottom = $bottom -replace ($replace,$buildInfo)
$bottom | out-file "$($pwd.path)\\framework\\bottom.html"
'''
            }
        }
        
        stage ('Deploy to webserver') {
            steps {
                powershell label: '', script: 'copy-item -path "$($pwd.path)\\framework\\*" -destination \'c:\\inetpub\\wwwroot\''
                powershell label: '', script: 'copy-item -path "$($pwd.path)\\content\\*" -destination \'c:\\inetpub\\wwwroot\''
            }
        }
    }
    
}